# 백엔드 모니터링 & 성능 개선 프로젝트

## 목표

API 에 많은 트래픽이 들어왔을 때,
Grafana 를 통해서 모니터링을 해보고,
성능을 개선 시킬 수 있는 전략들을 선택해서 각각의 성능 지표들을 측정해보자

모니터링 경험 + 성능 개선 경험을 얻기 위함

## 전략 유형

1. Redis 캐싱
2. Index 처리

## 측정 지표

1. p90 : 전체 요청 중 90% 가 이 시간 이내에 처리됨 (사용자 경험 지표)
2. p95 : 전체 요청 중 95% 가 이 시간 이내에 처리됨
3. RPS(Request Per Second) : 초당 처리 가능한 요청 수
4. avg latency : 모든 요청 응답 시간의 평균값

##

K6 를 통해서 동시 요청을 10, 50, 100 씩 30초간 보내보았다.

| VU  | avg latency | p95     | RPS   |
| --- | ----------- | ------- | ----- |
| 10  | ~7.5ms      | ~8.5ms  | ~1320 |
| 50  | ~36.5ms     | ~42.6ms | ~1365 |
| 100 | ~71.5ms     | ~77.5ms | ~1396 |

결과를 보면,
p95 지표는 선형적으로 증가했지만, RPS 는 1400 을 넘지 못하는 모습을 볼 수 있다.
즉 서버의 초당 처리량에서 병목이 발생하고 있다.

<img src = "assets/image1.png">

VUS 를 500으로 하니 요청 오류가 났다.
mysql 의 connection pool size 를 찾아보니,

mysql 명령어 : SHOW VARIABLES LIKE '%max_connection%';
max_connections 151
mysqlx_max_connections 100
이라서,

SET GLOBAL max_connections = 500; 을 통해
max connection 을 올렸다.

이후 VUS 를 200 으로 올렸을 때,
p95 에서 약간의 병목이 발생했다

| VU      | avg latency | p95         | RPS      |
| ------- | ----------- | ----------- | -------- |
| 10      | 7.5ms       | 8.5ms       | 1320     |
| 50      | 36.5ms      | 42.6ms      | 1365     |
| 100     | 71.5ms      | 77.5ms      | 1396     |
| **200** | **117.6ms** | **259.2ms** | **1606** |
